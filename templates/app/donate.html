{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate</title>
    <link rel="stylesheet" href="{% static 'css/donate.css' %}">
</head>
<body>
    <header>
        <h1>Donate Items</h1>
    </header>
    <main>
        <section class="donate-form">
            <form id="donateForm" method="post">
                {% csrf_token %}
                <label for="item">Item:</label>
                <input type="text" id="item" name="item" required>
                
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" required>
                
                <label for="expiryDate">Expiry Date:</label>
                <input type="date" id="expiryDate" name="expiryDate" required>
                
                <button type="submit">Donate</button>
            </form>
        </section>
        <section class="donations-list">
            <h2>Current Donations</h2>
            <table id="donationsTable">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Expiry Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for donation in donations %}
                    <tr>
                        <td>{{ donation.item_name }}</td>
                        <td>{{ donation.quantity }}</td>
                        <td>{{ donation.expiry_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </main>
    <script src="{% static 'js/donate.js' %}"></script>
    <script>
        document.getElementById('donateForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const item = document.getElementById('item').value;
            const quantity = document.getElementById('quantity').value;
            const expiryDate = document.getElementById('expiryDate').value;

            fetch("{% url 'donate' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    item: item,
                    quantity: quantity,
                    expiryDate: expiryDate
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const table = document.getElementById('donationsTable').getElementsByTagName('tbody')[0];
                    const newRow = table.insertRow();
                    newRow.insertCell(0).innerText = item;
                    newRow.insertCell(1).innerText = quantity;
                    newRow.insertCell(2).innerText = expiryDate;
                }
            });
        });
    </script>
</body>
</html>
